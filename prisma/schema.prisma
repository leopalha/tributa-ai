// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  USER
  EMPRESA
}

enum TCType {
  PRECATORIO
  HONORARIOS
  CONTRATO_EXTRAJUDICIAL
  EXCEDENTE_TRIBUTARIO
  CREDITO_TRIBUTARIO
  OUTROS
}

enum TCStatus {
  PENDENTE
  APROVADO
  REJEITADO
  EXPIRADO
  ATIVO
}

enum TipoNegociacao {
  LEILAO
  NEGOCIACAO_DIRETA
  VENDA_DIRETA
}

enum TipoGarantia {
  FIANCA
  SEGURO
  HIPOTECA
  PENHOR
}

enum FormaPagamento {
  TRANSFERENCIA_BANCARIA
  BOLETO
  PIX
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  image         String?
  password      String?
  role          UserRole  @default(USER)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  empresa       Empresa?  @relation("EmpresaToUser")
  tcs          TC[]      @relation("UserToTC")
  anuncios     Anuncio[] @relation("UserToAnuncio")
  propostas    Proposta[] @relation("UserToProposta")
  transacoes   Transacao[] @relation("UserToTransacao")
}

model Empresa {
  id            String   @id @default(cuid())
  razaoSocial   String
  nomeFantasia  String?
  cnpj          String   @unique
  inscEstadual  String?
  inscMunicipal String?
  endereco      Json
  telefone      String?
  email         String?
  website       String?
  status        String   @default("ATIVO")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user          User     @relation("EmpresaToUser", fields: [userId], references: [id])
  userId        String   @unique
  tcs           TC[]     @relation("EmpresaToTC")
}

model TC {
  id            String   @id @default(cuid())
  valor         Float
  dataEmissao   DateTime
  dataVencimento DateTime
  status        TCStatus
  tipo          TCType
  origem        TCType
  documentos    Json[]
  historico     Json[]
  garantias     Json[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user          User     @relation("UserToTC", fields: [userId], references: [id])
  userId        String
  empresa       Empresa  @relation("EmpresaToTC", fields: [empresaId], references: [id])
  empresaId     String
  anuncios      Anuncio[] @relation("TCToAnuncio")
}

model Anuncio {
  id                  String   @id @default(cuid())
  titulo              String
  descricao          String
  valorOriginal      Float
  valorMinimo        Float
  valorSugerido      Float
  tipoNegociacao     TipoNegociacao
  status             TCStatus
  dataPublicacao     DateTime
  dataExpiracao      DateTime
  visualizacoes      Int      @default(0)
  interessados       Int      @default(0)
  origemTC           TCType
  documentosNecessarios String[]
  garantias          Json[]
  restricoes         Json
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  tc                TC       @relation("TCToAnuncio", fields: [tcId], references: [id])
  tcId              String
  vendedor          User     @relation("UserToAnuncio", fields: [vendedorId], references: [id])
  vendedorId        String
  propostas         Proposta[] @relation("AnuncioToProposta")
  transacoes        Transacao[] @relation("AnuncioToTransacao")
}

model Proposta {
  id            String   @id @default(cuid())
  valor         Float
  condicoes     Json
  mensagem      String
  status        String
  dataExpiracao DateTime
  documentos    Json[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  anuncio       Anuncio  @relation("AnuncioToProposta", fields: [anuncioId], references: [id])
  anuncioId     String
  comprador     User     @relation("UserToProposta", fields: [compradorId], references: [id])
  compradorId   String
  transacao     Transacao? @relation("PropostaToTransacao")
}

model Transacao {
  id            String   @id @default(cuid())
  valor         Float
  status        String
  formaPagamento Json
  documentos    Json[]
  timeline      Json[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  anuncio       Anuncio  @relation("AnuncioToTransacao", fields: [anuncioId], references: [id])
  anuncioId     String
  vendedor      User     @relation("UserToTransacao", fields: [vendedorId], references: [id])
  vendedorId    String
  comprador     User     @relation("UserToTransacao", fields: [compradorId], references: [id])
  compradorId   String
  proposta      Proposta @relation("PropostaToTransacao", fields: [propostaId], references: [id])
  propostaId    String   @unique
} 